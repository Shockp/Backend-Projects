# ===================================================================
# PERSONAL BLOG APPLICATION - PERFORMANCE OPTIMIZATION CONFIGURATION
# ===================================================================
# This configuration file contains optimized settings for production deployment
# focusing on performance, caching, and database optimization.
#
# Usage: Include this file in your application properties or copy relevant
# settings to your main application.properties file.
#
# Author: Adrián Feito Blázquez (github.com/shockp)
# Version: 1.0
# ===================================================================

# ===================================================================
# DATABASE CONFIGURATION - POSTGRESQL OPTIMIZED
# ===================================================================

# Connection Pool Configuration (HikariCP)
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.pool-name=PersonalBlogHikariCP

# Connection Pool Optimization
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.connection-init-sql=SET search_path TO public
spring.datasource.hikari.auto-commit=false
spring.datasource.hikari.transaction-isolation=TRANSACTION_READ_COMMITTED

# ===================================================================
# JPA/HIBERNATE CONFIGURATION - PERFORMANCE OPTIMIZED
# ===================================================================

# Hibernate Performance Settings
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.jdbc.fetch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.batch_versioned_data=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# Connection and Statement Management
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
spring.jpa.properties.hibernate.connection.autocommit=false
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# Query Optimization
spring.jpa.properties.hibernate.query.plan_cache_max_size=2048
spring.jpa.properties.hibernate.query.plan_parameter_metadata_max_size=128
spring.jpa.properties.hibernate.query.fail_on_pagination_over_collection_fetch=true
spring.jpa.properties.hibernate.query.in_clause_parameter_padding=true

# Statistics and Monitoring
spring.jpa.properties.hibernate.generate_statistics=true
spring.jpa.properties.hibernate.session.events.log.LOG_QUERIES_SLOWER_THAN_MS=1000

# Second Level Cache Configuration
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.use_query_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory
spring.jpa.properties.hibernate.javax.cache.provider=com.github.benmanes.caffeine.jcache.spi.CaffeineCachingProvider
spring.jpa.properties.hibernate.javax.cache.missing_cache_strategy=create

# ===================================================================
# CACHING CONFIGURATION
# ===================================================================

# Spring Cache Configuration
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=1000,expireAfterAccess=300s,expireAfterWrite=600s,recordStats

# Redis Configuration (when available)
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.timeout=2000ms
spring.redis.lettuce.pool.max-active=8
spring.redis.lettuce.pool.max-idle=8
spring.redis.lettuce.pool.min-idle=0
spring.redis.lettuce.pool.max-wait=-1ms
spring.redis.lettuce.shutdown-timeout=100ms

# ===================================================================
# WEB CONFIGURATION - PERFORMANCE OPTIMIZED
# ===================================================================

# HTTP/2 Support
server.http2.enabled=true

# Compression
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml
server.compression.min-response-size=1024

# Connection Management
server.tomcat.max-connections=8192
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.connection-timeout=20000
server.tomcat.keep-alive-timeout=20000
server.tomcat.max-keep-alive-requests=100

# Buffer Sizes
server.tomcat.max-http-form-post-size=2MB
server.tomcat.max-swallow-size=2MB

# ===================================================================
# JACKSON CONFIGURATION - JSON OPTIMIZATION
# ===================================================================

# JSON Processing Optimization
spring.jackson.default-property-inclusion=NON_NULL
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.write-durations-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.mapper.accept-case-insensitive-enums=true

# ===================================================================
# LOGGING CONFIGURATION - PERFORMANCE MONITORING
# ===================================================================

# Root Logging Level
logging.level.root=INFO

# Application Logging
logging.level.com.personalblog=INFO
logging.level.com.personalblog.service=DEBUG
logging.level.com.personalblog.repository=DEBUG

# Hibernate Logging
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.hibernate.stat=INFO
logging.level.org.hibernate.cache=DEBUG

# Connection Pool Logging
logging.level.com.zaxxer.hikari=INFO
logging.level.com.zaxxer.hikari.HikariConfig=DEBUG

# Performance Logging
logging.level.org.springframework.cache=DEBUG
logging.level.org.springframework.transaction=DEBUG

# ===================================================================
# ACTUATOR CONFIGURATION - MONITORING
# ===================================================================

# Actuator Endpoints
management.endpoints.web.exposure.include=health,info,metrics,prometheus,caches,hikaricp,liquibase
management.endpoint.health.show-details=when-authorized
management.endpoint.health.show-components=always

# Health Indicators
management.health.db.enabled=true
management.health.redis.enabled=true
management.health.diskspace.enabled=true

# Metrics Configuration
management.metrics.enable.hikaricp=true
management.metrics.enable.jvm=true
management.metrics.enable.system=true
management.metrics.enable.tomcat=true
management.metrics.enable.cache=true

# Prometheus Metrics
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.percentiles.http.server.requests=0.5,0.9,0.95,0.99

# ===================================================================
# SECURITY CONFIGURATION - PERFORMANCE OPTIMIZED
# ===================================================================

# JWT Configuration
app.jwt.access-token-expiration=900000
app.jwt.refresh-token-expiration=86400000
app.jwt.secret=${JWT_SECRET:mySecretKey}

# Session Management
server.servlet.session.timeout=30m
server.servlet.session.cookie.max-age=1800
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true

# ===================================================================
# ASYNC CONFIGURATION - VIRTUAL THREADS (JAVA 21+)
# ===================================================================

# Virtual Threads Configuration
spring.threads.virtual.enabled=true

# Task Execution
spring.task.execution.pool.core-size=8
spring.task.execution.pool.max-size=16
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=blog-task-

# Task Scheduling
spring.task.scheduling.pool.size=4
spring.task.scheduling.thread-name-prefix=blog-scheduler-

# ===================================================================
# FILE UPLOAD CONFIGURATION
# ===================================================================

# Multipart Configuration
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
spring.servlet.multipart.file-size-threshold=2KB

# ===================================================================
# CUSTOM APPLICATION PROPERTIES
# ===================================================================

# Blog Configuration
app.blog.posts-per-page=10
app.blog.cache-duration=300
app.blog.search-results-limit=50
app.blog.max-comment-depth=5

# Performance Settings
app.performance.enable-query-logging=true
app.performance.slow-query-threshold=1000
app.performance.enable-cache-statistics=true
app.performance.enable-metrics=true

# Rate Limiting
app.rate-limit.enabled=true
app.rate-limit.requests-per-minute=60
app.rate-limit.burst-capacity=10

# ===================================================================
# DEVELOPMENT/TESTING OVERRIDES
# ===================================================================
# Uncomment these settings for development/testing environments

# Development Database (H2)
# spring.datasource.url=jdbc:h2:mem:testdb
# spring.datasource.driver-class-name=org.h2.Driver
# spring.datasource.username=sa
# spring.datasource.password=
# spring.h2.console.enabled=true

# Development Logging
# logging.level.org.springframework.web=DEBUG
# logging.level.org.springframework.security=DEBUG
# logging.level.org.hibernate.SQL=DEBUG
# logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Development Cache (disable for testing)
# spring.cache.type=none

# ===================================================================
# PRODUCTION OVERRIDES
# ===================================================================
# These settings should be used in production environments

# Production Logging
# logging.level.org.hibernate.SQL=WARN
# logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
# logging.level.com.personalblog=INFO

# Production Security
# server.servlet.session.cookie.secure=true
# server.ssl.enabled=true

# Production Database Pool
# spring.datasource.hikari.maximum-pool-size=50
# spring.datasource.hikari.minimum-idle=10

# ===================================================================
# MONITORING AND ALERTING THRESHOLDS
# ===================================================================

# Performance Thresholds
app.monitoring.query-time-threshold=1000
app.monitoring.cache-hit-ratio-threshold=0.8
app.monitoring.connection-pool-usage-threshold=0.8
app.monitoring.memory-usage-threshold=0.85

# Alert Configuration
app.alerts.enabled=true
app.alerts.email-notifications=true
app.alerts.slack-notifications=false

# ===================================================================
# END OF CONFIGURATION
# ===================================================================